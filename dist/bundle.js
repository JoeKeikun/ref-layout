!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["Ref-Layout"]=e():t["Ref-Layout"]=e()}(self,(()=>(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function i(t,e){for(var i=0,s=e.length;i<s;){var r=i+s>>>1;e[r]<t?i=r+1:s=r}return i}function s(t,e){for(var i,s=0,r=e.length-1;r-s>1;)e[i=Math.floor((s+r)/2)]<t?s=i:r=i;return t-e[s]<=e[r]-t?e[s]:e[r]}function r(t){var e=t.top,i=t.left,s=t.width,r=t.height,n=o(i,1),a=o(i+s/2,1),h=o(i+s,1),p=o(e,1),c=o(e+r/2,1),f=o(e+r,1);return{v:[{type:"vm",pos:a,start:p,end:f},{type:"vl",pos:n,start:p,end:f},{type:"vr",pos:h,start:p,end:f}],h:[{type:"hm",pos:c,start:n,end:h},{type:"ht",pos:p,start:n,end:h},{type:"hb",pos:f,start:n,end:h}]}}function o(t,e){return+t.toFixed(e)}t.r(e),t.d(e,{default:()=>h});var n=function(){return n=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)},a={adsorbDistance:0,rects:[],active:null,adsorbVLines:[],adsorbHLines:[],gridVLines:[],gridHLines:[]};const h=function(){function t(t){this._adsorbDistance=0,this._rects=null,this._activeRect=null,this._adsorbActiveRect=null,this._lines={vLines:new Map,vPositions:[],hLines:new Map,hPositions:[]},this._grid={vPositions:[],hPositions:[]},this._preOffsetX=null,this._preOffsetY=null,this._preLeft=null,this._preLeftAdsorbed=!1,this._preTop=null,this._preTopAdsorbed=!1;var e=Object.assign({},a,t);this.updateActive(e.active),this.updateRects(e.rects),this.updateAdsorbLine(e.adsorbVLines,"v"),this.updateAdsorbLine(e.adsorbHLines,"h"),this.updateGridLine(e.gridVLines,"v"),this.updateGridLine(e.gridHLines,"h"),this.updateAdsorbDistance(e.adsorbDistance)}return t.prototype.updateAdsorbDistance=function(t){this._adsorbDistance=t},t.prototype.updateRects=function(t){var e=this._lines;e.vLines=new Map,e.vPositions=[],e.hLines=new Map,e.hPositions=[];for(var s=[],o=0,a=t;o<a.length;o++){var h=a[o];if(!(h===this._activeRect||this._activeRect&&h.id===this._activeRect.id)){s.push(h);for(var p=h.id,c=r(h),f=0,d=c.v;f<d.length;f++){var v=d[f],u=Number(v.pos);if(!(g=e.vLines.get(u))){g=[];var l=i(u,e.vPositions);e.vPositions.splice(l,0,u)}g.push(n(n({},v),{id:p})),e.vLines.set(v.pos,g)}for(var _=0,b=c.h;_<b.length;_++){var g;v=b[_],u=Number(v.pos),(g=e.hLines.get(u))||(g=[],l=i(u,e.hPositions),e.hPositions.splice(l,0,u)),g.push(n(n({},v),{id:p})),e.hLines.set(v.pos,g)}}}this._rects=s},t.prototype.updateActive=function(t){this._activeRect=n({},t)},t.prototype.updateAdsorbLine=function(t,e){if(-1!==["v","h"].indexOf(e)&&Array.isArray(t)){var s,r;"v"===e?(s=this._lines.vLines,r=this._lines.vPositions):(s=this._lines.hLines,r=this._lines.hPositions);for(var o=0,n=t;o<n.length;o++){var a=n[o],h=Number(a),p=s.get(h);if(!p){p=[];var c=i(h,r);r.splice(c,0,a)}p.push({isAdsorbLine:!0,pos:a,start:0,end:0}),s.set(a,p)}}},t.prototype.updateGridLine=function(t,e){-1!==["v","h"].indexOf(e)&&Array.isArray(t)&&("v"===e?this._grid.vPositions=t.map((function(t){return Number(t)||0})).sort((function(t,e){return t-e})):this._grid.hPositions=t.map((function(t){return Number(t)||0})).sort((function(t,e){return t-e})))},t.prototype.calcAdsorb=function(t,e){this._adsorbActiveRect=null;var i=null!=this._preOffsetX&&t!==this._preOffsetX,n=null!=this._preOffsetY&&e!==this._preOffsetY,a=!1,h=!1;if(this._activeRect){this._adsorbActiveRect={width:this._activeRect.width,height:this._activeRect.height,top:o(this._activeRect.top+e,1),left:o(this._activeRect.left+t,1)};var p=r(this._adsorbActiveRect),c={gap:-1,offset:0},f={gap:-1,offset:0};if(i){for(var d=0,v=p.v;d<v.length;d++){var u=v[d],l=o(s(A=Number(u.pos),this._lines.vPositions)-A,1),_=Math.abs(l);(-1===c.gap||c.gap>_)&&(c.gap=_,c.offset=l)}-1!==c.gap&&c.gap<this._adsorbDistance&&(a=!0,this._adsorbActiveRect.left=o(this._adsorbActiveRect.left+c.offset,1))}else null!=this._preLeft&&(a=this._preLeftAdsorbed,this._adsorbActiveRect.left=this._preLeft);if(n){for(var b=0,g=p.h;b<g.length;b++){var A;u=g[b],l=o(s(A=Number(u.pos),this._lines.hPositions)-A,1),_=Math.abs(l),(-1===f.gap||f.gap>_)&&(f.gap=_,f.offset=l)}-1!==f.gap&&f.gap<this._adsorbDistance&&(h=!0,this._adsorbActiveRect.top=o(this._adsorbActiveRect.top+f.offset,1))}else null!=this._preTop&&(h=this._preTopAdsorbed,this._adsorbActiveRect.top=this._preTop);if(!a&&this._grid.vPositions.length>0){var L=s(this._adsorbActiveRect.left,this._grid.vPositions);this._adsorbActiveRect.left=L}!h&&this._grid.hPositions.length>0&&(L=s(this._adsorbActiveRect.top,this._grid.hPositions),this._adsorbActiveRect.top=L),this._preOffsetX=t,this._preOffsetY=e,this._preLeft=this._adsorbActiveRect.left,this._preLeftAdsorbed=a,this._preTop=this._adsorbActiveRect.top,this._preTopAdsorbed=h}},t.prototype.getAdsorbActiveRect=function(){return this._adsorbActiveRect},t.prototype.getRefLines=function(){var t=this,e=[];if(!this._adsorbActiveRect)return e;for(var i=r(this._adsorbActiveRect),s=function(s){var r=i.v[s],n=o._lines.vLines.get(r.pos);if(n){n=n.filter((function(t){return!t.isAdsorbLine}));var a=r.start,h=r.end,p=[];n.forEach((function(e){a=Math.min(e.start,a),h=Math.max(e.end,h),t._rects&&p.push(t._rects.find((function(t){return t.id===e.id})))})),e.push({type:"v",left:r.pos,top:a,size:h-a,refRects:p})}},o=this,n=0;n<i.v.length;n++)s(n);var a=function(s){var r=i.h[s],o=h._lines.hLines.get(r.pos);if(o){o=o.filter((function(t){return!t.isAdsorbLine}));var n=r.start,a=r.end,p=[];o.forEach((function(e){n=Math.min(e.start,n),a=Math.max(e.end,a),t._rects&&p.push(t._rects.find((function(t){return t.id===e.id})))})),e.push({type:"h",top:r.pos,left:n,size:a-n,refRects:p})}},h=this;for(n=0;n<i.h.length;n++)a(n);return e},t}();return e})()));